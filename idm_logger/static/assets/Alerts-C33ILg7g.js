import{r as u,K as B,y as g,a as l,f as e,h as _,j as p,F as A,x as M,t as n,ac as U,q as d,ad as c,ae as f,o,n as j}from"./index-BM82s5Vd.js";const F={class:"space-y-6"},N={class:"flex justify-between items-center"},L={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},q={key:0,class:"p-6 text-center text-gray-500"},G={key:1,class:"p-6 text-center text-gray-500"},I={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700"},K={class:"flex items-center justify-between"},T={class:"flex-1 min-w-0"},W={class:"flex items-center space-x-3"},D={class:"text-lg font-medium text-gray-900 dark:text-white truncate"},H={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},E={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},P={key:0},R={key:1},J={class:"mt-1 text-xs text-gray-400 font-mono truncate"},O={class:"flex items-center space-x-2 ml-4"},Q=["onClick"],X={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Y={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},Z={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"},ee=["onClick"],te=["onClick"],se={key:0,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"},re={class:"bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full p-6 shadow-xl"},ae={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},le={key:0,class:"space-y-4 border-l-4 border-blue-500 pl-4 py-2 bg-gray-50 dark:bg-gray-900"},oe=["value"],ne={class:"grid grid-cols-2 gap-4"},de={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ie={class:"mt-1 text-xs text-gray-500"},me={__name:"Alerts",setup(ue){const v=u([]),m=u([]),y=u(!0),x=u(!1),i=u(null),a=u({name:"",type:"threshold",sensor:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0});B(async()=>{await S(),await b()});async function S(){try{const r=await g.get("/api/control");m.value=r.data}catch(r){console.error("Failed to load sensors",r)}}async function b(){y.value=!0;try{const r=await g.get("/api/alerts");v.value=r.data}catch(r){console.error("Failed to load alerts",r)}finally{y.value=!1}}function h(r=null){r?(i.value=r,a.value={...r}):(i.value=null,a.value={name:"",type:"threshold",sensor:m.value.length>0?m.value[0].name:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0}),x.value=!0}function k(){x.value=!1,i.value=null}async function z(){try{i.value?await g.put("/api/alerts",{id:i.value.id,...a.value}):await g.post("/api/alerts",a.value),await b(),k()}catch(r){alert("Fehler beim Speichern: "+(r.response?.data?.error||r.message))}}async function C(r){if(confirm(`Alarm "${r.name}" wirklich löschen?`))try{await g.delete(`/api/alerts?id=${r.id}`),await b()}catch{r("Fehler beim Löschen")}}async function V(r){try{await g.put("/api/alerts",{id:r.id,enabled:!r.enabled}),await b()}catch(t){console.error("Failed to toggle alert",t)}}function $(r){return r<60?`${r}s`:r<3600?`${Math.floor(r/60)}m`:r<86400?`${Math.floor(r/3600)}h`:`${Math.floor(r/86400)}d`}return(r,t)=>(o(),l("div",F,[e("div",N,[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Alarme & Benachrichtigungen",-1)),e("button",{onClick:t[0]||(t[0]=s=>h()),class:"btn-primary"},[...t[8]||(t[8]=[e("span",{class:"mr-2"},"+",-1),p(" Neuer Alarm ",-1)])])]),e("div",L,[y.value?(o(),l("div",q,"Lade Alarme...")):v.value.length===0?(o(),l("div",G," Keine Alarme konfiguriert. ")):(o(),l("ul",I,[(o(!0),l(A,null,M(v.value,s=>(o(),l("li",{key:s.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition"},[e("div",K,[e("div",T,[e("div",W,[e("h3",D,n(s.name),1),e("span",{class:j([{"bg-green-100 text-green-800":s.enabled,"bg-gray-100 text-gray-800":!s.enabled},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(s.enabled?"Aktiv":"Inaktiv"),3),e("span",H,n(s.type==="threshold"?"Grenzwert":"Status"),1)]),e("p",E,[s.type==="threshold"?(o(),l("span",P,[t[10]||(t[10]=p(" Wenn ",-1)),e("strong",null,n(s.sensor),1),p(" "+n(s.condition)+" ",1),e("strong",null,n(s.threshold),1)])):(o(),l("span",R," Regelmäßiger Statusbericht ")),t[11]||(t[11]=e("span",{class:"mx-2"},"•",-1)),e("span",null,"Intervall: "+n($(s.interval_seconds)),1)]),e("p",J,' "'+n(s.message)+'" ',1)]),e("div",O,[e("button",{onClick:w=>V(s),class:"text-gray-400 hover:text-blue-500"},[(o(),l("svg",X,[s.enabled?(o(),l("path",Z)):(o(),l("path",Y))]))],8,Q),e("button",{onClick:w=>h(s),class:"text-gray-400 hover:text-yellow-500"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])],8,ee),e("button",{onClick:w=>C(s),class:"text-gray-400 hover:text-red-500"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,te)])])]))),128))]))]),x.value?(o(),l("div",se,[e("div",re,[e("h3",ae,n(i.value?"Alarm bearbeiten":"Neuer Alarm"),1),e("form",{onSubmit:U(z,["prevent"]),class:"space-y-4"},[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),d(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>a.value.name=s),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,a.value.name]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Typ",-1)),d(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.type=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[15]||(t[15]=[e("option",{value:"threshold"},"Grenzwert-Alarm",-1),e("option",{value:"status"},"Statusbericht",-1)])],512),[[f,a.value.type]])]),a.value.type==="threshold"?(o(),l("div",le,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Sensor",-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.sensor=s),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[(o(!0),l(A,null,M(m.value,s=>(o(),l("option",{key:s.name,value:s.name},n(s.name)+" ("+n(s.unit)+")",9,oe))),128))],512),[[f,a.value.sensor]])]),e("div",ne,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Bedingung",-1)),d(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.condition=s),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[18]||(t[18]=[e("option",{value:">"},"Größer als (>)",-1),e("option",{value:"<"},"Kleiner als (<)",-1),e("option",{value:"="},"Gleich (=)",-1),e("option",{value:"!="},"Ungleich (!=)",-1)])],512),[[f,a.value.condition]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Schwellenwert",-1)),d(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=s=>a.value.threshold=s),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,a.value.threshold]])])])])):_("",!0),e("div",null,[e("label",de,n(a.value.type==="status"?"Sende-Intervall (Sekunden)":"Cooldown / Sperrzeit (Sekunden)"),1),d(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=s=>a.value.interval_seconds=s),min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,a.value.interval_seconds]]),e("p",ie,n(a.value.type==="status"?"Wie oft soll der Status gesendet werden (z.B. 86400 für täglich).":"Wie lange soll nach einem Alarm gewartet werden, bis erneut gesendet wird."),1)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nachricht",-1)),d(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.message=s),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,a.value.message]]),t[22]||(t[22]=e("p",{class:"mt-1 text-xs text-gray-500"}," Platzhalter: {value}, {sensor}, {name}, {time} ",-1))]),e("div",{class:"mt-5 flex justify-end space-x-3"},[e("button",{type:"button",onClick:k,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600"}," Abbrechen "),t[23]||(t[23]=e("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"}," Speichern ",-1))])],32)])])):_("",!0)]))}};export{me as default};

import{r as u,K as B,y as m,a as s,f as e,h as A,j as f,F as _,x as M,t as n,ac as U,q as d,ad as c,ae as p,o,n as j}from"./index-mB4EineT.js";const F={class:"space-y-6"},N={class:"flex justify-between items-center"},L={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},q={key:0,class:"p-6 text-center text-gray-500"},G={key:1,class:"p-6 text-center text-gray-500"},I={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700"},K={class:"flex items-center justify-between"},T={class:"flex-1 min-w-0"},W={class:"flex items-center space-x-3"},D={class:"text-lg font-medium text-gray-900 dark:text-white truncate"},H={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},E={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},P={key:0},R={key:1},J={class:"mt-1 text-xs text-gray-400 font-mono truncate"},O={class:"flex items-center space-x-2 ml-4"},Q=["onClick","aria-label","title"],X={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Y={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},Z={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"},ee=["onClick"],te=["onClick"],ae={key:0,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"},re={class:"bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full p-6 shadow-xl"},le={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},se={key:0,class:"space-y-4 border-l-4 border-blue-500 pl-4 py-2 bg-gray-50 dark:bg-gray-900"},oe=["value"],ne={class:"grid grid-cols-2 gap-4"},de={for:"alert-interval",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ie={class:"mt-1 text-xs text-gray-500"},ge={__name:"Alerts",setup(ue){const v=u([]),g=u([]),y=u(!0),x=u(!1),i=u(null),l=u({name:"",type:"threshold",sensor:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0});B(async()=>{await S(),await b()});async function S(){try{const r=await m.get("/api/control");g.value=r.data}catch(r){console.error("Failed to load sensors",r)}}async function b(){y.value=!0;try{const r=await m.get("/api/alerts");v.value=r.data}catch(r){console.error("Failed to load alerts",r)}finally{y.value=!1}}function h(r=null){r?(i.value=r,l.value={...r}):(i.value=null,l.value={name:"",type:"threshold",sensor:g.value.length>0?g.value[0].name:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0}),x.value=!0}function k(){x.value=!1,i.value=null}async function z(){try{i.value?await m.put("/api/alerts",{id:i.value.id,...l.value}):await m.post("/api/alerts",l.value),await b(),k()}catch(r){alert("Fehler beim Speichern: "+(r.response?.data?.error||r.message))}}async function C(r){if(confirm(`Alarm "${r.name}" wirklich löschen?`))try{await m.delete(`/api/alerts?id=${r.id}`),await b()}catch{r("Fehler beim Löschen")}}async function V(r){try{await m.put("/api/alerts",{id:r.id,enabled:!r.enabled}),await b()}catch(t){console.error("Failed to toggle alert",t)}}function $(r){return r<60?`${r}s`:r<3600?`${Math.floor(r/60)}m`:r<86400?`${Math.floor(r/3600)}h`:`${Math.floor(r/86400)}d`}return(r,t)=>(o(),s("div",F,[e("div",N,[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Alarme & Benachrichtigungen",-1)),e("button",{onClick:t[0]||(t[0]=a=>h()),class:"btn-primary"},[...t[8]||(t[8]=[e("span",{class:"mr-2"},"+",-1),f(" Neuer Alarm ",-1)])])]),e("div",L,[y.value?(o(),s("div",q,"Lade Alarme...")):v.value.length===0?(o(),s("div",G," Keine Alarme konfiguriert. ")):(o(),s("ul",I,[(o(!0),s(_,null,M(v.value,a=>(o(),s("li",{key:a.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition"},[e("div",K,[e("div",T,[e("div",W,[e("h3",D,n(a.name),1),e("span",{class:j([{"bg-green-100 text-green-800":a.enabled,"bg-gray-100 text-gray-800":!a.enabled},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(a.enabled?"Aktiv":"Inaktiv"),3),e("span",H,n(a.type==="threshold"?"Grenzwert":"Status"),1)]),e("p",E,[a.type==="threshold"?(o(),s("span",P,[t[10]||(t[10]=f(" Wenn ",-1)),e("strong",null,n(a.sensor),1),f(" "+n(a.condition)+" ",1),e("strong",null,n(a.threshold),1)])):(o(),s("span",R," Regelmäßiger Statusbericht ")),t[11]||(t[11]=e("span",{class:"mx-2"},"•",-1)),e("span",null,"Intervall: "+n($(a.interval_seconds)),1)]),e("p",J,' "'+n(a.message)+'" ',1)]),e("div",O,[e("button",{onClick:w=>V(a),class:"text-gray-400 hover:text-blue-500","aria-label":a.enabled?"Alarm deaktivieren":"Alarm aktivieren",title:a.enabled?"Alarm deaktivieren":"Alarm aktivieren"},[(o(),s("svg",X,[a.enabled?(o(),s("path",Z)):(o(),s("path",Y))]))],8,Q),e("button",{onClick:w=>h(a),class:"text-gray-400 hover:text-yellow-500","aria-label":"Alarm bearbeiten",title:"Alarm bearbeiten"},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])],8,ee),e("button",{onClick:w=>C(a),class:"text-gray-400 hover:text-red-500","aria-label":"Alarm löschen",title:"Alarm löschen"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,te)])])]))),128))]))]),x.value?(o(),s("div",ae,[e("div",re,[e("h3",le,n(i.value?"Alarm bearbeiten":"Neuer Alarm"),1),e("form",{onSubmit:U(z,["prevent"]),class:"space-y-4"},[e("div",null,[t[14]||(t[14]=e("label",{for:"alert-name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),d(e("input",{id:"alert-name",type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>l.value.name=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,l.value.name]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"alert-type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Typ",-1)),d(e("select",{id:"alert-type","onUpdate:modelValue":t[2]||(t[2]=a=>l.value.type=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[15]||(t[15]=[e("option",{value:"threshold"},"Grenzwert-Alarm",-1),e("option",{value:"status"},"Statusbericht",-1)])],512),[[p,l.value.type]])]),l.value.type==="threshold"?(o(),s("div",se,[e("div",null,[t[17]||(t[17]=e("label",{for:"alert-sensor",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Sensor",-1)),d(e("select",{id:"alert-sensor","onUpdate:modelValue":t[3]||(t[3]=a=>l.value.sensor=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[(o(!0),s(_,null,M(g.value,a=>(o(),s("option",{key:a.name,value:a.name},n(a.name)+" ("+n(a.unit)+")",9,oe))),128))],512),[[p,l.value.sensor]])]),e("div",ne,[e("div",null,[t[19]||(t[19]=e("label",{for:"alert-condition",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Bedingung",-1)),d(e("select",{id:"alert-condition","onUpdate:modelValue":t[4]||(t[4]=a=>l.value.condition=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[18]||(t[18]=[e("option",{value:">"},"Größer als (>)",-1),e("option",{value:"<"},"Kleiner als (<)",-1),e("option",{value:"="},"Gleich (=)",-1),e("option",{value:"!="},"Ungleich (!=)",-1)])],512),[[p,l.value.condition]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"alert-threshold",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Schwellenwert",-1)),d(e("input",{id:"alert-threshold",type:"text","onUpdate:modelValue":t[5]||(t[5]=a=>l.value.threshold=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,l.value.threshold]])])])])):A("",!0),e("div",null,[e("label",de,n(l.value.type==="status"?"Sende-Intervall (Sekunden)":"Cooldown / Sperrzeit (Sekunden)"),1),d(e("input",{id:"alert-interval",type:"number","onUpdate:modelValue":t[6]||(t[6]=a=>l.value.interval_seconds=a),min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,l.value.interval_seconds]]),e("p",ie,n(l.value.type==="status"?"Wie oft soll der Status gesendet werden (z.B. 86400 für täglich).":"Wie lange soll nach einem Alarm gewartet werden, bis erneut gesendet wird."),1)]),e("div",null,[t[21]||(t[21]=e("label",{for:"alert-message",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nachricht",-1)),d(e("textarea",{id:"alert-message","onUpdate:modelValue":t[7]||(t[7]=a=>l.value.message=a),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,l.value.message]]),t[22]||(t[22]=e("p",{class:"mt-1 text-xs text-gray-500"}," Platzhalter: {value}, {sensor}, {name}, {time} ",-1))]),e("div",{class:"mt-5 flex justify-end space-x-3"},[e("button",{type:"button",onClick:k,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600"}," Abbrechen "),t[23]||(t[23]=e("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"}," Speichern ",-1))])],32)])])):A("",!0)]))}};export{ge as default};

import{r as i,K as U,y as u,a as s,f as e,h,j as k,F as w,x as A,t as n,ad as j,q as m,ae as c,af as _,o,n as T}from"./index-Dq30hFFt.js";const G={class:"space-y-6"},L={class:"flex justify-between items-center"},q={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},I={key:0,class:"p-6 text-center text-gray-500"},W={key:1,class:"p-6 text-center text-gray-500"},D={key:2,class:"divide-y divide-gray-200 dark:divide-gray-700"},K={class:"flex items-center justify-between"},H={class:"flex-1 min-w-0"},E={class:"flex items-center space-x-3"},O={class:"text-lg font-medium text-gray-900 dark:text-white truncate"},P={class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800"},R={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},J={key:0},Q={key:1},X={class:"mt-1 text-xs text-gray-400 font-mono truncate"},Y={class:"flex items-center space-x-2 ml-4"},Z=["onClick","aria-label","title"],ee={xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},te={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"},ae={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"},le=["onClick"],re=["onClick"],se={key:0,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"},oe={class:"bg-white dark:bg-gray-800 rounded-lg max-w-lg w-full p-6 shadow-xl"},ne={class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},de={key:0,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},ie=["value"],ue={key:1,class:"space-y-4 border-l-4 border-blue-500 pl-4 py-2 bg-gray-50 dark:bg-gray-900"},me=["value"],ge={class:"grid grid-cols-2 gap-4"},be={for:"alert-interval",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},ve={class:"mt-1 text-xs text-gray-500"},pe={__name:"Alerts",setup(ce){const y=i([]),g=i([]),p=i([]),x=i(!0),f=i(!1),d=i(null),r=i({name:"",type:"threshold",sensor:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0});U(async()=>{await z(),await b(),await S()});async function S(){try{const l=await u.get("/api/alerts/templates");p.value=l.data}catch(l){console.error("Failed to load templates",l)}}async function z(){try{const l=await u.get("/api/control");g.value=l.data}catch(l){console.error("Failed to load sensors",l)}}async function b(){x.value=!0;try{const l=await u.get("/api/alerts");y.value=l.data}catch(l){console.error("Failed to load alerts",l)}finally{x.value=!1}}function V(l=null){l?(d.value=l,r.value={...l}):(d.value=null,r.value={name:"",type:"threshold",sensor:g.value.length>0?g.value[0].name:"",condition:">",threshold:"",message:"Alarm: {name} - {sensor} ist {value} um {time}",interval_seconds:3600,enabled:!0}),f.value=!0}function M(){f.value=!1,d.value=null}function C(l){const t=l.target.value;if(!t)return;const a=p.value.find(v=>v.name===t);a&&(r.value={...r.value,...a.alert_data},r.value.enabled=!0),l.target.value=""}async function $(){try{d.value?await u.put("/api/alerts",{id:d.value.id,...r.value}):await u.post("/api/alerts",r.value),await b(),M()}catch(l){alert("Fehler beim Speichern: "+(l.response?.data?.error||l.message))}}async function B(l){if(confirm(`Alarm "${l.name}" wirklich löschen?`))try{await u.delete(`/api/alerts?id=${l.id}`),await b()}catch{l("Fehler beim Löschen")}}async function F(l){try{await u.put("/api/alerts",{id:l.id,enabled:!l.enabled}),await b()}catch(t){console.error("Failed to toggle alert",t)}}function N(l){return l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:`${Math.floor(l/86400)}d`}return(l,t)=>(o(),s("div",G,[e("div",L,[t[10]||(t[10]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Alarme & Benachrichtigungen",-1)),e("button",{onClick:t[0]||(t[0]=a=>V()),class:"btn-primary"},[...t[9]||(t[9]=[e("span",{class:"mr-2"},"+",-1),k(" Neuer Alarm ",-1)])])]),e("div",q,[x.value?(o(),s("div",I,"Lade Alarme...")):y.value.length===0?(o(),s("div",W," Keine Alarme konfiguriert. ")):(o(),s("ul",D,[(o(!0),s(w,null,A(y.value,a=>(o(),s("li",{key:a.id,class:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition"},[e("div",K,[e("div",H,[e("div",E,[e("h3",O,n(a.name),1),e("span",{class:T([{"bg-green-100 text-green-800":a.enabled,"bg-gray-100 text-gray-800":!a.enabled},"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},n(a.enabled?"Aktiv":"Inaktiv"),3),e("span",P,n(a.type==="threshold"?"Grenzwert":"Status"),1)]),e("p",R,[a.type==="threshold"?(o(),s("span",J,[t[11]||(t[11]=k(" Wenn ",-1)),e("strong",null,n(a.sensor),1),k(" "+n(a.condition)+" ",1),e("strong",null,n(a.threshold),1)])):(o(),s("span",Q," Regelmäßiger Statusbericht ")),t[12]||(t[12]=e("span",{class:"mx-2"},"•",-1)),e("span",null,"Intervall: "+n(N(a.interval_seconds)),1)]),e("p",X,' "'+n(a.message)+'" ',1)]),e("div",Y,[e("button",{onClick:v=>F(a),class:"text-gray-400 hover:text-blue-500","aria-label":a.enabled?"Alarm deaktivieren":"Alarm aktivieren",title:a.enabled?"Alarm deaktivieren":"Alarm aktivieren"},[(o(),s("svg",ee,[a.enabled?(o(),s("path",ae)):(o(),s("path",te))]))],8,Z),e("button",{onClick:v=>V(a),class:"text-gray-400 hover:text-yellow-500","aria-label":"Alarm bearbeiten",title:"Alarm bearbeiten"},[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)])],8,le),e("button",{onClick:v=>B(a),class:"text-gray-400 hover:text-red-500","aria-label":"Alarm löschen",title:"Alarm löschen"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,re)])])]))),128))]))]),f.value?(o(),s("div",se,[e("div",oe,[e("h3",ne,n(d.value?"Alarm bearbeiten":"Neuer Alarm"),1),e("form",{onSubmit:j($,["prevent"]),class:"space-y-4"},[d.value?h("",!0):(o(),s("div",de,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-blue-900 dark:text-blue-100 mb-2"},"Vorlage laden (Optional)",-1)),e("select",{onChange:t[1]||(t[1]=a=>C(a)),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm"},[t[15]||(t[15]=e("option",{value:""},"-- Vorlage auswählen --",-1)),(o(!0),s(w,null,A(p.value,a=>(o(),s("option",{key:a.name,value:a.name},n(a.name)+" - "+n(a.description),9,ie))),128))],32),t[17]||(t[17]=e("p",{class:"mt-1 text-xs text-blue-800 dark:text-blue-200"}," Wähle eine Vorlage, um die Felder automatisch auszufüllen. ",-1))])),e("div",null,[t[18]||(t[18]=e("label",{for:"alert-name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Name",-1)),m(e("input",{id:"alert-name",type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>r.value.name=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,r.value.name]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"alert-type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Typ",-1)),m(e("select",{id:"alert-type","onUpdate:modelValue":t[3]||(t[3]=a=>r.value.type=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[19]||(t[19]=[e("option",{value:"threshold"},"Grenzwert-Alarm",-1),e("option",{value:"status"},"Statusbericht",-1)])],512),[[_,r.value.type]])]),r.value.type==="threshold"?(o(),s("div",ue,[e("div",null,[t[21]||(t[21]=e("label",{for:"alert-sensor",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Sensor",-1)),m(e("select",{id:"alert-sensor","onUpdate:modelValue":t[4]||(t[4]=a=>r.value.sensor=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[(o(!0),s(w,null,A(g.value,a=>(o(),s("option",{key:a.name,value:a.name},n(a.name)+" ("+n(a.unit)+")",9,me))),128))],512),[[_,r.value.sensor]])]),e("div",ge,[e("div",null,[t[23]||(t[23]=e("label",{for:"alert-condition",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Bedingung",-1)),m(e("select",{id:"alert-condition","onUpdate:modelValue":t[5]||(t[5]=a=>r.value.condition=a),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},[...t[22]||(t[22]=[e("option",{value:">"},"Größer als (>)",-1),e("option",{value:"<"},"Kleiner als (<)",-1),e("option",{value:"="},"Gleich (=)",-1),e("option",{value:"!="},"Ungleich (!=)",-1)])],512),[[_,r.value.condition]])]),e("div",null,[t[24]||(t[24]=e("label",{for:"alert-threshold",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Schwellenwert",-1)),m(e("input",{id:"alert-threshold",type:"text","onUpdate:modelValue":t[6]||(t[6]=a=>r.value.threshold=a),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,r.value.threshold]])])])])):h("",!0),e("div",null,[e("label",be,n(r.value.type==="status"?"Sende-Intervall (Sekunden)":"Cooldown / Sperrzeit (Sekunden)"),1),m(e("input",{id:"alert-interval",type:"number","onUpdate:modelValue":t[7]||(t[7]=a=>r.value.interval_seconds=a),min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[c,r.value.interval_seconds]]),e("p",ve,n(r.value.type==="status"?"Wie oft soll der Status gesendet werden (z.B. 86400 für täglich).":"Wie lange soll nach einem Alarm gewartet werden, bis erneut gesendet wird."),1)]),e("div",null,[t[25]||(t[25]=e("label",{for:"alert-message",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nachricht (Anpassbar)",-1)),m(e("textarea",{id:"alert-message","onUpdate:modelValue":t[8]||(t[8]=a=>r.value.message=a),rows:"3",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Gib hier deine individuelle Nachricht ein..."},null,512),[[c,r.value.message]]),t[26]||(t[26]=e("p",{class:"mt-1 text-xs text-gray-500"}," Du kannst diesen Text bearbeiten. Verfügbare Platzhalter: {value}, {sensor}, {name}, {time} ",-1))]),e("div",{class:"mt-5 flex justify-end space-x-3"},[e("button",{type:"button",onClick:M,class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600"}," Abbrechen "),t[27]||(t[27]=e("button",{type:"submit",class:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"}," Speichern ",-1))])],32)])])):h("",!0)]))}};export{pe as default};
